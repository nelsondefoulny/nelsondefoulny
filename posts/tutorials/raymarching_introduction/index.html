
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Simple ray marched sphere using custom node in UE5.">
      
      
        <meta name="author" content="Nelson Defoulny">
      
      
        <link rel="canonical" href="https://nelsondefoulny.github.io/posts/tutorials/raymarching_introduction/">
      
      
        <link rel="prev" href="../../professional_projects/mz_kalulu/">
      
      
        <link rel="next" href="../raymarching_lava_lamp/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>UE Ray Marching Introduction - Nelson Defoulny</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../styles/extra.css">
    
      <link rel="stylesheet" href="../../../styles/footer.css">
    
      <link rel="stylesheet" href="../../../styles/post_header.css">
    
      <link rel="stylesheet" href="../../../styles/tiles.css">
    
      <link rel="stylesheet" href="../../../styles/print.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-is-ray-marching" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<span style="color: white;"><strong>⚠️ This site is currently under construction ! ⚠️</strong></span>

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Nelson Defoulny" class="md-header__button md-logo" aria-label="Nelson Defoulny" data-md-component="logo">
      
  <img src="../../../assets/nd_white_alpha.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nelson Defoulny
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              UE Ray Marching Introduction
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Nelson Defoulny" class="md-nav__button md-logo" aria-label="Nelson Defoulny" data-md-component="logo">
      
  <img src="../../../assets/nd_white_alpha.png" alt="logo">

    </a>
    Nelson Defoulny
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tag Index
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Professional Projects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Professional Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/bn_virtual_production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual Production
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/bn_msg_sphere_projection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSG Sphere Projection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/bn_pavillon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pavillon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/mm_pirata_et_capitano/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pirata Et Capitano Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/mm_ue_animation_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UE Animation Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/mm_motion_capture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Motion Capture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/sw_smart_mirror/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Smart Mirror
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/sw_expert_road_safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expert Road Safety
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../professional_projects/mz_kalulu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kalulu
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    UE Ray Marching Introduction
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    UE Ray Marching Introduction
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-ray-marching" class="md-nav__link">
    <span class="md-ellipsis">
      What Is Ray Marching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What Is Ray Marching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signed-distance-functionsfields" class="md-nav__link">
    <span class="md-ellipsis">
      Signed Distance Functions/Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unreal-engine-quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Unreal Engine Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Unreal Engine Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ray-direction" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iteration-and-ray-speed" class="md-nav__link">
    <span class="md-ellipsis">
      Iteration and Ray Speed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixing-scale" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing Scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixing-position" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing Position
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sphere-tracing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sphere Tracing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../raymarching_lava_lamp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UE Ray Marching Lava Lamp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../material_hlsl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UE HLSL in Materials
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
<div class="post-header">

  <!-- <p><strong>Title:</strong> UE Ray Marching Introduction</p> -->
  <!-- <p><strong>UE Ray Marching Introduction</strong></p> -->

  <!-- 
    <p><strong>Description:</strong> Simple ray marched sphere using custom node in UE5.</p>
   -->

  
    <div class="box"><p><strong>Author:</strong> Nelson Defoulny</p></div>
  

  
    <div class="box"><p><strong>Category:</strong> Tutorials</p></div>
  

  
    <div class="box"><p><strong>Unreal Engine Version:</strong> 5.5</p></div>
  

</div>





  


  <nav class="md-tags" >
    
      
      
      
        <a href="../../../tags/#tag:hlsl" class="md-tag">HLSL</a>
      
    
      
      
      
        <a href="../../../tags/#tag:unreal-engine-5" class="md-tag">Unreal Engine 5</a>
      
    
  </nav>





  <h1>UE Ray Marching Introduction</h1>
  <!-- <img src="https://nelsondefoulny.github.io/assets/ue_icon_black.png" alt="Unreal Engine" width="32" height="32" /> -->

<div class="grid cards">
<figure>
<p><img alt="DemoPrimitives" src="../../../assets/raymarching/demo_primitives.gif" width="640" /> </p>
<figcaption>
<p>Animation by <a href="https://iquilezles.org/">Inigo Quilez</a> via <a href="https://www.shadertoy.com/view/Xds3zN">Shadertoy</a><br />
Licensed under <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
</figcaption>
</figure>
<figure>
<p><img alt="DemoOceanic" src="../../../assets/raymarching/demo_oceanic.gif" width="640" /></p>
<figcaption>
<p>Animation by <a href="https://www.shadertoy.com/user/frankenburgh">Frank Hugenroth</a> via <a href="https://www.shadertoy.com/view/4sXGRM#">Shadertoy</a><br />
Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">CC BY-NC-SA 3.0</a>.</p>
</figcaption>
</figure>
<figure>
<p><img alt="DemoCosmicMarble" src="../../../assets/raymarching/demo_cosmic_marble.gif" width="640" /></p>
<figcaption>
<p>Animation by <a href="https://www.shadertoy.com/user/eddietree">Eddie Lee</a> via <a href="https://www.shadertoy.com/view/llSSWW">Shadertoy</a></p>
</figcaption>
</figure>
<figure>
<p><img alt="DemoLiberation" src="../../../assets/raymarching/demo_liberation.gif" width="640" /> </p>
<figcaption>
<p>Animation by <a href="https://www.shadertoy.com/user/Kali">Dave Hoskins</a> via <a href="https://www.shadertoy.com/view/tlGfzd">Shadertoy</a></p>
</figcaption>
</figure>
</div>
<h2 id="what-is-ray-marching">What Is Ray Marching</h2>
<p>Ray marching is a group of 3D rendering technics where rays are sampled iteratively segment by segment, computing some function at each step. </p>
<h3 id="use-cases">Use Cases</h3>
<ul>
<li>Voxel Rendering</li>
<li>Volumetric Rendering</li>
<li>Fluid Rendering</li>
<li>Screen Space Reflection</li>
<li>Screen Space Shadows </li>
<li>Physics Simulation</li>
<li>Morphing Shapes</li>
<li>Geometry Repetition</li>
<li>Algorithmically defined Scenes</li>
</ul>
<h3 id="signed-distance-functionsfields">Signed Distance Functions/Fields</h3>
<p>Ray marching often takes advantage of SDFs in order to improve sampling or as scene representation. </p>
<p>A <strong>signed distance function</strong> returns the shortest distance from any point in space to the surface of a shape. The sign indicates whether the point is inside (negative), on (zero), or outside (positive) the shape. Complex shape can be assemble from SDF primitives using simple math function.</p>
<p>A <strong>signed distance field</strong> is a 3D (or 2D) spatial representation where each point stores the signed distance to the nearest surface. It can be calculated procedurally from signed distance functions or stored in a texture/volume.</p>
<p><strong>In this article SDF refers to signed distance function</strong></p>
<p>SDF can be quite frightening for people who don't like math but fortunately we can use them without diving into the maths. However, for those who want to understand that part, lets detail some examples to see how SDFs are built.</p>
<h4 id="examples">Examples</h4>
<div class="language-hlsl highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">// p : position</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="c1">// s : scale</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">sdSphere</span><span class="p">(</span><span class="kt">float3</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="p">}</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1">// p : position</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">// b : bounds/extent</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">sdBox</span><span class="p">(</span><span class="kt">float3</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">float3</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a><span class="p">{</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="kt">float3</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><a href="#__codelineno-0-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><a href="#__codelineno-0-14"><span class="linenos" data-linenos="14 "></span></a><span class="p">}</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><a href="#__codelineno-0-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><a href="#__codelineno-0-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1">// d1 : distance1 (sdf1)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><a href="#__codelineno-0-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">// d2 : distance2 (sdf2)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><a href="#__codelineno-0-18"><span class="linenos" data-linenos="18 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">opUnion</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">d2</span><span class="p">)</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><a href="#__codelineno-0-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">{</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><a href="#__codelineno-0-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="p">);</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><a href="#__codelineno-0-21"><span class="linenos" data-linenos="21 "></span></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="sampling">Sampling</h3>
<p>Rays can be sample in multiple ways depending on the application. The most naïve approach is to sample rays at fixed intervals, which heavily impact performance and precision. The second approach is to use distance aware sampling method that adapt step interval based on the scene being rendered.  </p>
<h4 id="sphere-tracing">Sphere Tracing</h4>
<p>Sphere tracing idea is too take advantage of SDFs to evaluate the distance from current sampling point to nearest surface. The next sampling point can be moved by this distance along the ray without missing any surface. When the evaluated distance is bellow a threshold, then the ray is close enough to a surface and the sampling must stop and return evaluated surface color.</p>
<figure>
<p><img alt="Sphere Tracing" src="../../../assets/raymarching/spheretracing.png" width="600" /></p>
<figcaption>
<p>Image by <a href="https://commons.wikimedia.org/wiki/User:Teadrinker">Teadrinker</a>, via <a href="https://commons.wikimedia.org/wiki/File:Visualization_of_SDF_ray_marching_algorithm.png">Wikimedia Commons</a><br />
Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</p>
</figcaption>
</figure>
<h4 id="volumetric">Volumetric</h4>
<p>In volumetric ray marching, all sampled point contribute to final color. For example this can be used to render clouds, gaz or liquids. </p>
<h3 id="references">References</h3>
<p>If you want to learn more about ray marching or SDF I highly recommend to check Inigo Quilez work https://iquilezles.org/. On his website you can also found collection of <a href="https://iquilezles.org/articles/distfunctions2d/">2D SDFs</a> and <a href="https://iquilezles.org/articles/distfunctions/">3D SDFs</a>.</p>
<p>As a deeper introduction to Ray Marching you can also check :<br />
- <a href="https://www.youtube.com/watch?v=BNZtUB7yhX4&amp;ab_channel=SimonDev">Ray Marching Introduction From SimonDev</a> <br />
- <a href="https://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/">Ray Marching Introduction From Jamie Wong</a></p>
<h2 id="unreal-engine-quick-start">Unreal Engine Quick Start</h2>
<p>The easiest method to start playing with ray marching in Unreal Engine is to use Custom Node in a Material. It can either be a mesh material or a post process material. In order to render a single object mesh material is more flexible and has a lower rendering cost. Switching to post process become interesting if you need to render multiple objects or if you want to render translucent ray marched volume on top of each others.</p>
<p>Let's start by ray marching a simple sdf shape with fixed step sampling. </p>
<p>We need :<br />
- A Material<br />
- A Custom Node with 3 parameters :<br />
    - Ray Start Location<br />
    - Ray Direction<br />
    - Ray Speed / Interval<br />
- Sphere signed distance function<br />
- Ray marching sampling code</p>
<p><img alt="RayMarchSphere" src="../../../assets/raymarching/intro_step_sampling.png" /></p>
<p>The actual mesh (rendered in black) can be hidden using opacity (or opacity mask)</p>
<p><img alt="RayMarchSphereMask" src="../../../assets/raymarching/mask.png" width="300" /></p>
<div class="language-hlsl highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="c1">// Ray Sampling </span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="kt">float3</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RayStart</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RayDir</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">RaySpeed</span><span class="p">;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos=" 5 "></span></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="c1">// Sphere SDF</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">Position</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">45.0f</span><span class="p">;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="c1">// Sphere Surface is close enough</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">RaySpeed</span><span class="p">)</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><a href="#__codelineno-1-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><a href="#__codelineno-1-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kt">float4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><a href="#__codelineno-1-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><a href="#__codelineno-1-14"><span class="linenos" data-linenos="14 "></span></a><span class="p">}</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><a href="#__codelineno-1-15"><span class="linenos" data-linenos="15 "></span></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><a href="#__codelineno-1-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">return</span><span class="w"> </span><span class="kt">float4</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
</span></code></pre></div>
<p>The ray marching renderer is quite simple. We start from the Camera Position and move along the Camera Direction incrementing by a fixed distance (Ray Speed) at each step. Once we are "on" the shape (<code>Distance &lt; Threshold</code>) we return sphere color and opacity, if ray does not touch the shape after a fix number of iteration then we return black/masked color. </p>
<h3 id="ray-direction">Ray Direction</h3>
<p>In unreal engine the camera direction is defined from world position to camera. Therefore, it has to be inverted to get a vector that point towards the world. It is also worth noticing that the ray direction vector has to be normalize which is already the case for unreal camera direction vector.</p>
<h3 id="iteration-and-ray-speed">Iteration and Ray Speed</h3>
<p>The number of iteration have a huge impact on performances as each pixel run all iteration unless it reach the sdf.</p>
<p>If the camera distance to the shape is greater than NbIteration * RaySpeed then no pixel will be render because the algorithm will reach NbIteration before the ray can reach the shape.</p>
<p>Increasing Ray Speed increase maximum rendering distance but decrease rendering precision and quality. Ray speed is also linked to shape distance threshold because it make no sense to have a threshold smaller that the sampling distance which would implies that the sampling can jump over the test. In this example I used RaySpeed (1.0f) as a threshold for shape detection which means that detail lower than 1cm (unreal engine unit) won't be rendered. </p>
<h3 id="fixing-scale">Fixing Scale</h3>
<p>The scaling of the sphere seems wrong. I used a radius of 45cm so we would expect the sdf sphere to be almost the same size as the preview mesh but it is not. This is because material preview meshes have a different size than basic shapes used in the scene. It is easier to work on sdf geometry if the containing mesh have a known size. </p>
<figure>
<p><img alt="RayMarchSphereWithScale" src="../../../assets/raymarching/intro_material_mesh.png" /></p>
<figcaption>
<p>After swapping the mesh to default sphere shape.</p>
</figcaption>
</figure>
<h3 id="fixing-position">Fixing Position</h3>
<p>This first example does not take into account the shape location so the rendered sphere is always at world origin independently of the object location therefore it should render full black/masked unless the object you want to render is at world origin. </p>
<p>There are two ways of moving SDF location. We can modify the SDF directly but this will be impracticable when we will combine multiple SDFs to create complex shapes. As we want the sample relative position to the SDF, a much better approach is to modify the sampled position so it is relative to SDF location rather than the origin.</p>
<div class="language-hlsl highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1">// we keep the SDF on origin</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">SdSphere</span><span class="p">(</span><span class="kt">float3</span><span class="w"> </span><span class="n">Pos</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">Radius</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">Pos</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Radius</span><span class="p">;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">}</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><a href="#__codelineno-2-6"><span class="linenos" data-linenos="6 "></span></a><span class="c1">// sdf is called using relative position</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><a href="#__codelineno-2-7"><span class="linenos" data-linenos="7 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SdSphere</span><span class="p">(</span><span class="n">RayPosition</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ObjectPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">45.0f</span><span class="p">);</span>
</span></code></pre></div>
<p>I add Object World Position to the Custom Node and use the relative position to compute the sphere SDF.</p>
<p><img alt="RayMarchSphereWithPosition" src="../../../assets/raymarching/intro_position.png" /></p>
<p>Now the sphere should render properly if move the mesh in the scene.</p>
<h3 id="sphere-tracing_1">Sphere Tracing</h3>
<p>As we saw, using fixed step sampling heavily impact the render distance, precision and the performances. Therefore a much better approach it to use Sphere Tracing. As shown in the first chapter, this technic use an adaptive sampling distance based on the SDF being rendered which have several advantages.</p>
<p>The threshold is not tied anymore to the ray fixed step and can be much more precise. </p>
<p>The ray move through the map really quickly when far away from the SDF therefore reducing the number of iteration required. </p>
<div class="language-hlsl highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">TotalDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kt">float</span><span class="w"> </span><span class="n">Threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="p">{</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="c1">// Ray Sampling</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span><span class="kt">float3</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RayStart</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RayDir</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TotalDistance</span><span class="p">;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="c1">// Relative Position</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="kt">float3</span><span class="w"> </span><span class="n">RelativePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ShapePosition</span><span class="p">;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="c1">// Sphere SDF</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">RelativePosition</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ShapeScale</span><span class="p">;</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="c1">// Sphere Surface is close enough</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><a href="#__codelineno-3-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Threshold</span><span class="p">)</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a><a href="#__codelineno-3-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><a href="#__codelineno-3-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kt">float4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><a href="#__codelineno-3-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a><a href="#__codelineno-3-20"><span class="linenos" data-linenos="20 "></span></a>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21"></a><a href="#__codelineno-3-21"><span class="linenos" data-linenos="21 "></span></a><span class="w">    </span><span class="c1">// Adaptive distance for next step</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22"></a><a href="#__codelineno-3-22"><span class="linenos" data-linenos="22 "></span></a><span class="w">    </span><span class="n">TotalDistance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Distance</span><span class="p">;</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23"></a><a href="#__codelineno-3-23"><span class="linenos" data-linenos="23 "></span></a><span class="p">}</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24"></a><a href="#__codelineno-3-24"><span class="linenos" data-linenos="24 "></span></a>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25"></a><a href="#__codelineno-3-25"><span class="linenos" data-linenos="25 "></span></a><span class="k">return</span><span class="w"> </span><span class="kt">float4</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
</span></code></pre></div>
<p>In this implementation I used a total distance that grows adaptively to replace the fixed steps based on iteration index. </p>
<p>It is worth noticing that :<br />
- The number of iteration has decrease significantly. <br />
- The threshold is now really precise. <br />
- The camera distance to the shape is not constrained anymore.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://iquilezles.org/articles/distfunctions2d/">SDF 2D</a></li>
<li><a href="https://iquilezles.org/articles/distfunctions/">SDF 3D</a></li>
<li><a href="https://www.youtube.com/watch?v=BNZtUB7yhX4&amp;ab_channel=SimonDev">Ray Marching Intro Video</a></li>
<li><a href="https://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/">Ray Marching Intro</a></li>
<li><a href="https://www.youtube.com/watch?v=RRE-F57fbXw&amp;t=128s&amp;ab_channel=VictorGordan">PBR Introduction</a></li>
<li><a href="https://learnopengl.com/PBR/Lighting">PBR in detail</a></li>
<li><a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/volume-rendering-for-developers/intro-volume-rendering.html">Scratch a Pixel Volume Rendering Course</a></li>
<li><a href="https://shaderbits.com/blog/creating-volumetric-ray-marcher">Shader Bits Volumetric Ray Marching</a></li>
<li>
<p><a href="https://wallisc.github.io/rendering/2020/12/08/Making-Of-Moana-the-shadertoy.html">Moana Water Tutorial</a></p>
</li>
<li>
<p><a href="https://github.com/A57R4L/SceneViewExtensionTemplate/tree/main">Scene View Extension Template (Unreal Global Shader)</a></p>
</li>
</ul>







  
  




  





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" hidden>
        
          
          <a href="../../professional_projects/mz_kalulu/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Kalulu">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Kalulu
              </div>
            </div>
          </a>
        
        
          
          <a href="../raymarching_lava_lamp/" class="md-footer__link md-footer__link--next" aria-label="Next: UE Ray Marching Lava Lamp">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                UE Ray Marching Lava Lamp
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Nelson Defoulny. Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC BY 4.0</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>

<div class="md-footer-ue">
  <span>Powered by</span>
  <img class="ue-logo" src="/assets/ue_logo_horizontal_white.svg" alt="Unreal Engine" />
</div>




      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/ndefoulny" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.footer", "navigation.indexes", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>